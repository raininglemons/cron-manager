var cronManager=function(e){function t(s){if(n[s])return n[s].exports;var i=n[s]={exports:{},id:s,loaded:!1};return e[s].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(4),r=s(i),o=n(1),a=s(o),u=new r.default;window.location.search.indexOf("makeJob")>-1&&u.register("test-job",15e3,function(e,t){setTimeout(function(){console.log("Delaying job by pinging it"),t()},.8*a.default.jobTimeout),setTimeout(function(){console.log("Sending result"),e({ihazGotHamburgers:Date.now()})},1.6*a.default.jobTimeout),console.debug("Assigned to process job")},function(e){return console.warn("Got a result :D",e)}),t.default=u},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={pingInterval:15e3,jobTimeout:1e4,localStorage:{eventKey:"domsevent",metaStorageKey:"domsstorage"},indexedDb:{db:"domsevent",objectType:"domsevent"}};t.default=n},function(e,t){"use strict";function n(){for(var e={},t=s,n=arguments.length,c=Array(n),d=0;d<n;d++)c[d]=arguments[d];"number"==typeof c[c.length-1]&&(t=c.splice(c.length-1,1),s<t&&(t=s));var f="#"+c.join("/")+":";return i.forEach(function(n,s){s<=t?a?e[n]=function(){u!==f&&(null!==u&&(o.groupEnd(),clearTimeout(l)),o.group(f),u=f,l=setTimeout(function(){o.groupEnd(),u=null},16));for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(o[n]||o.log).apply(o,t)}:e[n]=function(){var e;return(o[n]||o.log).apply(o,(e=[f]).concat.apply(e,arguments))}:e[n]=r}),e}Object.defineProperty(t,"__esModule",{value:!0});var s=/not minified/.test(function(){})?3:0,i=["error","warn","log","debug"],r=function(){},o=console,a=!!o.group,u=null,l=null;t.default=n},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),i=function(){function e(t,s,i){n(this,e),this.uuid=t,this.lastPing=s,this.registeredJobs=[],this.assignedJobs=[],this.isActive=!0,this.callback=i}return s(e,[{key:"didPing",value:function(e){return this.lastPing=e,this}},{key:"removeAssignedJob",value:function(e){var t=this.assignedJobs.indexOf(e);return t>-1&&this.assignedJobs.splice(t,1),this}},{key:"addAssignedJob",value:function(e){var t=this.assignedJobs.indexOf(e);return t===-1&&this.assignedJobs.push(e),this}},{key:"removeRegisteredJob",value:function(e){var t=this.registeredJobs.indexOf(e);return t>-1&&this.registeredJobs.splice(t,1),this}},{key:"addRegisteredJob",value:function(e){var t=this.registeredJobs.indexOf(e);return t===-1&&this.registeredJobs.push(e),this}}]),e}();t.default=i},function(e,t,n){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),o=n(11),a=s(o),u=n(2),l=s(u),c=n(5),d=s(c),f=n(1),g=s(f),v=(0,l.default)("Client.js",0),h="undefined"!=typeof SharedWorker,b=function(){function e(){var t=this;if(i(this,e),this.uuid=a.default.v4(),this.jobs={},h){var s=n(9)();this.webWorkerPort=s.port,v.warn("Success in loading worker",s),this.webWorkerPort.addEventListener("message",this.receiveWorkerMessage.bind(this),!1),this.webWorkerPort.start()}else this.daemon=new d.default(this.uuid,this.receiveMessage.bind(this));this.emit(c.MessageTypes.PING),setInterval(function(){return t.emit(c.MessageTypes.PING)},.5*g.default.pingInterval),window.addEventListener("unload",function(){return t.emit(c.MessageTypes.UNREGISTERASSIGNEE)})}return r(e,[{key:"emit",value:function(e,t,n){var s={type:e,job:t,data:n,uuid:this.uuid};v.warn("Emitting message locally",s),h?this.webWorkerPort.postMessage(s):this.daemon.send(s)}},{key:"receiveWorkerMessage",value:function(e){v.log("Received message from daemon",e),this.receiveMessage(e.data)}},{key:"receiveMessage",value:function(e){var t=e.type,n=e.job,s=e.data;switch(t){case c.MessageTypes.ASSIGNEDJOB:return this.executeJob(n);case c.MessageTypes.JOBCOMPLETED:return this.completedJob(n,s);default:v.error("Unknown message type")}}},{key:"executeJob",value:function(e){var t=this;v.debug("Running job",e);var n=function(n){t.emit(c.MessageTypes.JOBCOMPLETED,e,n),t.completedJob(e,n)},s=function(){t.emit(c.MessageTypes.PINGJOB,e)};if(!this.jobs[e]||!this.jobs[e].runner)throw new Error("Couldn't find runner for "+e);var i=this.jobs[e].runner(n,s);void 0!==i&&n(i)}},{key:"completedJob",value:function(e,t){v.debug("Completed job",e),this.jobs[e]&&this.jobs[e].callback||v.debug("No callback found"),this.jobs[e].callback(t)}},{key:"register",value:function(e,t,n,s){if(!e)throw new Error("Job name cannot be empty");if(!t&&"number"!=typeof t)throw new Error("Interval is required and must be a number");if(!n&&"function"!=typeof n)throw new Error("Runner is required and must be a function");return this.jobs[e]={callback:s,runner:n},this.emit(c.MessageTypes.REGISTERJOB,e,{interval:t,name:e}),this}},{key:"unregister",value:function(e){return this.jobs[e]=null,this.emit(c.MessageTypes.UNREGISTERJOB,e),this}}]),e}();t.default=b},function(e,t,n){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.MessageTypes=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),o=n(2),a=s(o),u=n(1),l=s(u),c=n(3),d=s(c),f=n(6),g=s(f),v=n(7),h=n(8),b=(s(h),(0,a.default)("CronDaemon.js",3)),y=t.MessageTypes={PING:"PING",REGISTERJOB:"REGISTER-JOB",ASSIGNEDJOB:"ASSIGNED-JOB",PINGJOB:"PING-JOB",JOBCOMPLETED:"JOB-COMPLETED",UNREGISTERASSIGNEE:"UNREGISTER-ASSIGNEE",UNREGISTERJOB:"UNREGISTER-JOB"},p=function(){function e(t,n){i(this,e),this.localUuid=t||null,this.localCallback=n||null,this.assignees=[],this.jobs=[],this.ready=!1,this.pendingMessages=[],this.isWorker=!t&&!n,this.register(),b.log("Jobs?",this.jobs)}return r(e,[{key:"register",value:function(){var e=this;if(this.isWorker)(0,v.getStore)(function(t){var n=t.get("cache");n.onsuccess=n.onerror=function(){if(n.result){var t=n.result.state.jobs;e.jobs=t.map(function(e){var t=new g.default;return b.log("Trying to restore job",e,t),Object.assign(t,e)})}e.ready=!0,e.pendingMessages.forEach(function(t){return e.onReceive(t)}),e.houseKeeping(),setInterval(function(){return e.houseKeeping()},100)}});else{var t=window.localStorage.getItem(l.default.localStorage.metaStorageKey);if(t)try{var n=JSON.parse(t),s=n.assignees,i=n.jobs;this.assignees=s.map(function(e){var t=new d.default;return Object.assign(t,e)}),this.jobs=i.map(function(e){var t=new g.default;return b.log("Trying to restore job",e,t),Object.assign(t,e)})}catch(e){b.warn("Cached state unreadable",e)}b.warn("Restored state",t),this.ready=!0,this.houseKeeping(),window.addEventListener("storage",function(t){return e.onReceiveMessage(t)}),setInterval(function(){return e.houseKeeping()},1e3),setInterval(function(){return e.persistState()},1e3)}}},{key:"houseKeeping",value:function(){var e=this,t=this.now(),n=t-l.default.pingInterval;this.assignees.filter(function(e){return e.lastPing<n}).forEach(function(t){var n=t.uuid;return e.unregisterAssignee(n)}),this.jobs.filter(function(e){var n=e.interval,s=e.lastSucceeded,i=e.assignees;return 0===i.length&&s<t-n}).forEach(function(t){return e.unregisterJob(t)});var s=t-l.default.jobTimeout;this.jobs.filter(function(e){var t=e.assignedTo,n=e.lastAssigned;return null!==t&&n<s}).forEach(function(t){return e.distributeJob(t)}),this.jobs.filter(function(e){var n=e.assignedTo,s=e.interval,i=e.lastSucceeded;return null===n&&i<t-s}).forEach(function(t){return e.distributeJob(t)})}},{key:"persistState",value:function(){var e=this;if(this.isWorker)!function(){var t={jobs:e.jobs};(0,v.getStore)(function(e){b.debug("Saving state",t),e.put({state:t,key:"cache"})})}();else{var t={assignees:this.assignees,jobs:this.jobs},n=window.localStorage.getItem(l.default.localStorage.metaStorageKey),s=JSON.stringify(t);n!==s&&window.localStorage.setItem(l.default.localStorage.metaStorageKey,s)}}},{key:"emit",value:function(e){b.warn("Emiting message",e);var t=JSON.stringify(e);return this.lastMessage=t,window.localStorage.setItem(l.default.localStorage.eventKey,t),this}},{key:"send",value:function(e){return this.ready?this.onReceive(e):this.pendingMessages.push(e),this.isWorker||this.emit(e),this}},{key:"onReceiveMessage",value:function(e){if(e.key===l.default.localStorage.eventKey&&e.newValue!==this.lastMessage)return this.onReceive(JSON.parse(e.newValue)),this}},{key:"onReceive",value:function(e){switch(b.debug("Received message",e),e.type){case y.PING:this.onReceivePing(e);break;case y.REGISTERJOB:this.onReceiveRegisterJob(e);break;case y.ASSIGNEDJOB:this.onReceiveJobAssigned(e);break;case y.PINGJOB:this.onReceivePingJob(e);break;case y.UNREGISTERASSIGNEE:this.onReceiveUnregisterAssignee(e);break;case y.JOBCOMPLETED:this.onReceiveJobCompleted(e);break;case y.UNREGISTERJOB:this.onReceiveUnregisterJob(e);break;default:b.warn("Unrecognised message type")}if(this.isWorker)switch(e.type){case y.UNREGISTERASSIGNEE:case y.JOBCOMPLETED:this.persistState()}}},{key:"onReceivePing",value:function(e){var t=this.getAssignee(e.uuid);return null===t?this.registerAssignee(e.uuid,e.callback):void t.didPing(this.now())}},{key:"onReceiveUnregisterAssignee",value:function(e){var t=e.uuid;this.unregisterAssignee(t),this.isWorker&&0===this.assignees.length&&(b.warn("Shared worker is about to die. Save state now"),this.persistState())}},{key:"onReceiveRegisterJob",value:function(e){var t=e.uuid,n=e.data,s=this.registerJob(n);s.addAssignee(t);var i=this.getAssignee(t);if(i.addRegisteredJob(s.name),s.lastSucceeded>0){var r={type:y.JOBCOMPLETED,job:s.name,data:s.lastResponse};this.localUuid!==t&&this.localCallback?this.localCallback(r):i.callback&&i.callback(r)}}},{key:"onReceiveUnregisterJob",value:function(e){var t=e.uuid,n=e.job,s=this.getAssignee(t),i=this.getJob(n);i.removeAssignee(t),s.removeAssignedJob(n).removeRegisteredJob(n)}},{key:"onReceiveJobAssigned",value:function(e){var t=e.uuid,n=e.job;this.getJob(n).setAssignedTo(t,this.now());var s=this.getAssignee(t).addAssignedJob(n);t===this.localUuid&&this.localCallback?this.localCallback(e):s.callback&&(b.warn("Trying to emit message over postMessage",s),s.callback(e))}},{key:"onReceivePingJob",value:function(e){var t=e.uuid,n=e.job,s=this.getJob(n);s.assignedTo===t&&s.setAssignedTo(t,this.now())}},{key:"onReceiveJobCompleted",value:function(e){var t=e.uuid,n=e.job,s=e.data;this.getAssignee(t).removeAssignedJob(n),this.getJob(n).setCompleted(this.now(),s),this.localUuid!==t&&this.localCallback?this.getAssignee(this.localUuid).registeredJobs.indexOf(n)>-1&&this.localCallback(e):this.localCallback||this.assignees.filter(function(e){return e.uuid!==t&&e.registeredJobs.indexOf(n)>-1}).forEach(function(t){return t.callback(e)})}},{key:"distributeJob",value:function(e){b.warn("DISTRIBUTING JOB",this.now()-e.lastSucceeded);var t=this.assignees.filter(function(t){return t.registeredJobs.indexOf(e.name)>-1}).sort(function(e,t){if(t.isActive&&!e.isActive)return 1;if(e.isActive&&!t.isActive)return-1;var n=e.assignedJobs.length,s=t.assignedJobs.length;return n===s?t.lastPing-e.lastPing:n-s});if(0===t.length)return b.error("No assignees for job",e),void this.unregisterJob(e);var n=t.filter(function(e){return e.isActive});n.length?this.assignJob(n[0],e):this.assignJob(t[0],e)}},{key:"assignJob",value:function(e,t){this.send({uuid:e.uuid,job:t.name,type:y.ASSIGNEDJOB})}},{key:"registerAssignee",value:function(e,t){var n=new d.default(e,this.now(),t);b.debug("Adding assignee to the pool",n),this.assignees.push(n)}},{key:"unregisterAssignee",value:function(e){var t=this,n=this.getAssignee(e);if(null!==n){var s=this.assignees.indexOf(n);this.assignees.splice(s,1),n.registeredJobs.forEach(function(n){var s=t.getJob(n),i=s.assignees.indexOf(e);i!==-1&&s.assignees.splice(i,1)}),n.assignedJobs.forEach(function(e){var n=t.getJob(e);n.assignedTo=null}),b.debug("Removing assignee from pool",n)}}},{key:"getAssignee",value:function(e){var t=this.assignees.filter(function(t){return e===t.uuid});return 0===t.length?null:t[0]}},{key:"registerJob",value:function(e){var t=e.name,n=e.interval,s=this.getJob(t);if(null!==s)return b.debug("Amending job",e),s.setInterval(n),s;b.debug("Registering job",e);var i=new g.default(t,n);return this.jobs.push(i),i}},{key:"unregisterJob",value:function(e){var t=this;this.jobs.filter(function(t){var n=t.name;return n===e.name}).forEach(function(e){var n=t.jobs.indexOf(e);t.jobs.splice(n,1)})}},{key:"getJob",value:function(e){var t=this.jobs.filter(function(t){return e===t.name});return 0===t.length?null:t[0]}},{key:"now",value:function(){return Date.now()}}]),e}();t.default=p},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),i=function(){function e(t,s){n(this,e),this.name=t,this.interval=s,this.lastSucceeded=0,this.lastResponse=null,this.assignedTo=null,this.assignees=[]}return s(e,[{key:"setInterval",value:function(e){this.interval=e}},{key:"setAssignedTo",value:function(e,t){this.assignedTo=e,this.lastAssigned=t}},{key:"setCompleted",value:function(e,t){this.lastSucceeded=e,this.lastResponse=t,this.assignedTo=null}},{key:"removeAssignee",value:function(e){var t=this.assignees.indexOf(e);t>-1?this.assignees.splice(t,1):console.warn("Couldnt find uuid to remove",e,this),this.assignedTo===e&&(this.assignedTo=null)}},{key:"addAssignee",value:function(e){var t=this.assignees.indexOf(e);t===-1&&this.assignees.push(e)}}]),e}();t.default=i},function(e,t,n){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.getStore=void 0;var i=n(1),r=s(i),o="undefined"!=typeof self?self:o,a=o.indexedDB||o.mozIndexedDB||o.webkitIndexedDB||o.msIndexedDB,u=r.default.indexedDb.db,l=r.default.indexedDb.objectType,c=null,d=null,f=null,g=function(){d=c.result,f=d.createObjectStore(l,{keyPath:"key"}),console.log("upgradeNeeded")},v=function(){d=c.result;var e=d.transaction(l,"readwrite");f=e.objectStore(l),console.log("store loaded")},h=function(e){var t=d.transaction(l,"readwrite"),n=t.objectStore(l);e(n)};t.getStore=function(e){c||(c=a.open(u,1),c.addEventListener("upgradeneeded",g),c.addEventListener("success",v)),d?h(e):c.addEventListener("success",function(){return h(e)})}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=function e(t){if("object"!==("undefined"==typeof t?"undefined":n(t)))return t;if(t instanceof Array){var s=[].concat(t);s.map(e)}var i=Object.assign({},t);return Object.keys(i).forEach(function(t){i[t]=e(i[t])}),i};t.default=s},function(e,t,n){e.exports=function(){return new SharedWorker(n.p+"5a796bbb9a4651b70d1a.sharedworker.js")}},function(e,t){(function(t){var n,s=t.crypto||t.msCrypto;if(s&&s.getRandomValues){var i=new Uint8Array(16);n=function(){return s.getRandomValues(i),i}}if(!n){var r=new Array(16);n=function(){for(var e,t=0;t<16;t++)0===(3&t)&&(e=4294967296*Math.random()),r[t]=e>>>((3&t)<<3)&255;return r}}e.exports=n}).call(t,function(){return this}())},function(e,t,n){function s(e,t,n){var s=t&&n||0,i=0;for(t=t||[],e.toLowerCase().replace(/[0-9a-f]{2}/g,function(e){i<16&&(t[s+i++]=l[e])});i<16;)t[s+i++]=0;return t}function i(e,t){var n=t||0,s=u;return s[e[n++]]+s[e[n++]]+s[e[n++]]+s[e[n++]]+"-"+s[e[n++]]+s[e[n++]]+"-"+s[e[n++]]+s[e[n++]]+"-"+s[e[n++]]+s[e[n++]]+"-"+s[e[n++]]+s[e[n++]]+s[e[n++]]+s[e[n++]]+s[e[n++]]+s[e[n++]]}function r(e,t,n){var s=t&&n||0,r=t||[];e=e||{};var o=void 0!==e.clockseq?e.clockseq:g,a=void 0!==e.msecs?e.msecs:(new Date).getTime(),u=void 0!==e.nsecs?e.nsecs:h+1,l=a-v+(u-h)/1e4;if(l<0&&void 0===e.clockseq&&(o=o+1&16383),(l<0||a>v)&&void 0===e.nsecs&&(u=0),u>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");v=a,h=u,g=o,a+=122192928e5;var c=(1e4*(268435455&a)+u)%4294967296;r[s++]=c>>>24&255,r[s++]=c>>>16&255,r[s++]=c>>>8&255,r[s++]=255&c;var d=a/4294967296*1e4&268435455;r[s++]=d>>>8&255,r[s++]=255&d,r[s++]=d>>>24&15|16,r[s++]=d>>>16&255,r[s++]=o>>>8|128,r[s++]=255&o;for(var b=e.node||f,y=0;y<6;y++)r[s+y]=b[y];return t?t:i(r)}function o(e,t,n){var s=t&&n||0;"string"==typeof e&&(t="binary"==e?new Array(16):null,e=null),e=e||{};var r=e.random||(e.rng||a)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t)for(var o=0;o<16;o++)t[s+o]=r[o];return t||i(r)}for(var a=n(10),u=[],l={},c=0;c<256;c++)u[c]=(c+256).toString(16).substr(1),l[u[c]]=c;var d=a(),f=[1|d[0],d[1],d[2],d[3],d[4],d[5]],g=16383&(d[6]<<8|d[7]),v=0,h=0,b=o;b.v1=r,b.v4=o,b.parse=s,b.unparse=i,e.exports=b}]);