var cronManager=function(e){function t(s){if(n[s])return n[s].exports;var i=n[s]={exports:{},id:s,loaded:!1};return e[s].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),r=s(i),o=n(1),a=s(o),u=new r.default;window.location.search.indexOf("makeJob")>-1&&u.register("test-job",5e3,function(e,t){setTimeout(function(){console.log("Delaying job by pinging it"),t()},.8*a.default.jobTimeout),setTimeout(function(){console.log("Sending result"),e({ihazGotHamburgers:!0})},1.6*a.default.jobTimeout),setTimeout(function(){console.log("Trying to unregister job from self"),u.unregister("test-job")},1.6*a.default.jobTimeout+1e3),console.debug("Assigned to process job")},function(e){return console.warn("Got a result :D",e)}),t.default=u},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={pingInterval:15e3,jobTimeout:1e4,localStorage:{eventKey:"domsevent",metaStorageKey:"domsstorage"}};t.default=n},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),i=function(){function e(t,s,i){n(this,e),this.uuid=t,this.lastPing=s,this.registeredJobs=[],this.assignedJobs=[],this.isActive=!0,this.callback=i}return s(e,[{key:"didPing",value:function(e){return this.lastPing=e,this}},{key:"removeAssignedJob",value:function(e){var t=this.assignedJobs.indexOf(e);return t>-1&&this.assignedJobs.splice(t,1),this}},{key:"addAssignedJob",value:function(e){var t=this.assignedJobs.indexOf(e);return t===-1&&this.assignedJobs.push(e),this}},{key:"removeRegisteredJob",value:function(e){var t=this.registeredJobs.indexOf(e);return t>-1&&this.registeredJobs.splice(t,1),this}},{key:"addRegisteredJob",value:function(e){var t=this.registeredJobs.indexOf(e);return t===-1&&this.registeredJobs.push(e),this}}]),e}();t.default=i},function(e,t,n){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),o=n(9),a=s(o),u=n(6),l=s(u),c=n(4),f=s(c),g=n(1),d=s(g),v=(0,l.default)("Client.js",0),h="undefined"!=typeof SharedWorker,b=function(){function e(){var t=this;if(i(this,e),this.uuid=a.default.v4(),this.jobs={},h){var s=n(7)();this.webWorkerPort=s.port,v.warn("Success in loading worker",s),this.webWorkerPort.addEventListener("message",this.receiveWorkerMessage.bind(this),!1),this.webWorkerPort.start()}else this.daemon=new f.default(this.uuid,this.receiveMessage.bind(this));this.emit(c.MessageTypes.PING),setInterval(function(){return t.emit(c.MessageTypes.PING)},.5*d.default.pingInterval),window.addEventListener("unload",function(){return t.emit(c.MessageTypes.UNREGISTERASSIGNEE)})}return r(e,[{key:"emit",value:function(e,t,n){var s={type:e,job:t,data:n,uuid:this.uuid};v.warn("Emitting message locally",s),h?this.webWorkerPort.postMessage(s):this.daemon.send(s)}},{key:"receiveWorkerMessage",value:function(e){v.log("Received message from daemon",e),this.receiveMessage(e.data)}},{key:"receiveMessage",value:function(e){var t=e.type,n=e.job,s=e.data;switch(t){case c.MessageTypes.ASSIGNEDJOB:return this.executeJob(n);case c.MessageTypes.JOBCOMPLETED:return this.completedJob(n,s);default:v.error("Unknown message type")}}},{key:"executeJob",value:function(e){var t=this;v.debug("Running job",e);var n=function(n){t.emit(c.MessageTypes.JOBCOMPLETED,e,n),t.completedJob(e,n)},s=function(){t.emit(c.MessageTypes.PINGJOB,e)};if(!this.jobs[e]||!this.jobs[e].runner)throw new Error("Couldn't find runner for "+e);var i=this.jobs[e].runner(n,s);void 0!==i&&n(i)}},{key:"completedJob",value:function(e,t){v.debug("Completed job",e),this.jobs[e]&&this.jobs[e].callback||v.debug("No callback found"),this.jobs[e].callback(t)}},{key:"register",value:function(e,t,n,s){if(!e)throw new Error("Job name cannot be empty");if(!t&&"number"!=typeof t)throw new Error("Interval is required and must be a number");if(!n&&"function"!=typeof n)throw new Error("Runner is required and must be a function");return this.jobs[e]={callback:s,runner:n},this.emit(c.MessageTypes.REGISTERJOB,e,{interval:t,name:e}),this}},{key:"unregister",value:function(e){return this.jobs[e]=null,this.emit(c.MessageTypes.UNREGISTERJOB,e),this}}]),e}();t.default=b},function(e,t,n){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.MessageTypes=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),o=n(1),a=s(o),u=n(2),l=s(u),c=n(5),f=s(c),g=t.MessageTypes={PING:"PING",REGISTERJOB:"REGISTER-JOB",ASSIGNEDJOB:"ASSIGNED-JOB",PINGJOB:"PING-JOB",JOBCOMPLETED:"JOB-COMPLETED",UNREGISTERASSIGNEE:"UNREGISTER-ASSIGNEE",UNREGISTERJOB:"UNREGISTER-JOB"},d=function(){function e(t,n){var s=this;i(this,e),this.localUuid=t||null,this.localCallback=n||null,this.assignees=[],this.jobs=[],this.register(),console.log("Jobs?",this.jobs),setInterval(function(){return s.houseKeeping()},1e3),n&&setInterval(function(){return s.persistState()},1e3)}return r(e,[{key:"register",value:function(){var e=this;if(this.localUuid&&this.localCallback){var t=window.localStorage.getItem(a.default.localStorage.metaStorageKey);if(t)try{var n=JSON.parse(t),s=n.assignees,i=n.jobs;this.assignees=s.map(function(e){var t=new l.default;return Object.assign(t,e)}),this.jobs=i.map(function(e){var t=new f.default;return console.log("Trying to restore job",e,t),Object.assign(t,e)})}catch(e){console.warn("Cached state unreadable",e)}console.warn("Restored state",t),window.addEventListener("storage",function(t){return e.onReceiveMessage(t)})}}},{key:"houseKeeping",value:function(){var e=this,t=this.now(),n=t-a.default.pingInterval;this.assignees.filter(function(e){return e.lastPing<n}).forEach(function(t){var n=t.uuid;return e.unregisterAssignee(n)}),this.jobs.filter(function(e){var n=e.interval,s=e.lastSucceeded,i=e.assignees;return 0===i.length&&s<t-n}).forEach(function(t){return e.unregisterJob(t)});var s=t-a.default.jobTimeout;this.jobs.filter(function(e){var t=e.assignedTo,n=e.lastAssigned;return null!==t&&n<s}).forEach(function(t){return e.distributeJob(t)}),this.jobs.filter(function(e){var n=e.assignedTo,s=e.interval,i=e.lastSucceeded;return null===n&&i<t-s}).forEach(function(t){return e.distributeJob(t)})}},{key:"persistState",value:function(){var e=window.localStorage.getItem(a.default.localStorage.metaStorageKey),t=JSON.stringify({assignees:this.assignees,jobs:this.jobs});e!==t&&window.localStorage.setItem(a.default.localStorage.metaStorageKey,t)}},{key:"emit",value:function(e){console.warn("Emiting message",e);var t=JSON.stringify(e);return this.lastMessage=t,window.localStorage.setItem(a.default.localStorage.eventKey,t),this}},{key:"send",value:function(e){return console.warn("Receieved message locally",e),this.onReceive(e),this.localUuid&&this.localCallback&&this.emit(e),this}},{key:"onReceiveMessage",value:function(e){if(e.key===a.default.localStorage.eventKey&&e.newValue!==this.lastMessage)return this.onReceive(JSON.parse(e.newValue)),this}},{key:"onReceive",value:function(e){switch(console.debug("Received message",e),e.type){case g.PING:return this.onReceivePing(e);case g.REGISTERJOB:return this.onReceiveJobRegistration(e);case g.ASSIGNEDJOB:return this.onReceiveJobAssigned(e);case g.PINGJOB:return this.onReceivePingJob(e);case g.UNREGISTERASSIGNEE:return this.onReceiveUnregisterAssignee(e);case g.JOBCOMPLETED:return this.onReceiveJobCompleted(e);case g.UNREGISTERJOB:return this.onReceiveUnregisterJob(e);default:console.warn("Unrecognised message type")}}},{key:"onReceivePing",value:function(e){var t=this.getAssignee(e.uuid);return null===t?this.registerAssignee(e.uuid,e.callback):void t.didPing(this.now())}},{key:"onReceiveUnregisterAssignee",value:function(e){var t=e.uuid;this.unregisterAssignee(t)}},{key:"onReceiveJobRegistration",value:function(e){var t=e.uuid,n=e.data,s=this.registerJob(n);s.addAssignee(t);var i=this.getAssignee(t);i.registeredJobs.indexOf(s.name)===-1&&i.registeredJobs.push(s.name)}},{key:"onReceiveUnregisterJob",value:function(e){var t=e.uuid,n=e.job,s=this.getAssignee(t),i=this.getJob(n);i.removeAssignee(t),s.removeAssignedJob(n).removeRegisteredJob(n)}},{key:"onReceiveJobAssigned",value:function(e){var t=e.uuid,n=e.job;this.getJob(n).setAssignedTo(t,this.now());var s=this.getAssignee(t).addAssignedJob(n);t===this.localUuid&&this.localCallback?this.localCallback(e):(console.warn("Trying to emit message over postMessage",s),s.callback(e))}},{key:"onReceivePingJob",value:function(e){var t=e.uuid,n=e.job,s=this.getJob(n);s.assignedTo===t&&s.setAssignedTo(t,this.now())}},{key:"onReceiveJobCompleted",value:function(e){var t=e.uuid,n=e.job,s=e.data;this.getAssignee(t).removeAssignedJob(n),this.getJob(n).setCompleted(this.now(),s),this.localUuid!==t&&this.localCallback?this.getAssignee(this.localUuid).registeredJobs.indexOf(n)>-1&&this.localCallback(e):this.assignees.filter(function(e){return e.uuid!==t&&e.registeredJobs.indexOf(n)>-1}).forEach(function(t){return t.callback(e)})}},{key:"distributeJob",value:function(e){console.warn("DISTRIBUTING JOB",this.now()-e.lastSucceeded);var t=this.assignees.filter(function(t){return t.registeredJobs.indexOf(e.name)>-1}).sort(function(e,t){if(t.isActive&&!e.isActive)return 1;if(e.isActive&&!t.isActive)return-1;var n=e.assignedJobs.length,s=t.assignedJobs.length;return n===s?t.lastPing-e.lastPing:n-s});if(0===t.length)return console.error("No assignees for job",e),void this.unregisterJob(e);var n=t.filter(function(e){return e.isActive});n.length?this.assignJob(n[0],e):this.assignJob(t[0],e)}},{key:"assignJob",value:function(e,t){this.send({uuid:e.uuid,job:t.name,type:g.ASSIGNEDJOB})}},{key:"registerAssignee",value:function(e,t){var n=new l.default(e,this.now(),t);console.debug("Adding assignee to the pool",n),this.assignees.push(n)}},{key:"unregisterAssignee",value:function(e){var t=this,n=this.getAssignee(e);if(null!==n){var s=this.assignees.indexOf(n);this.assignees.splice(s,1),n.registeredJobs.forEach(function(n){var s=t.getJob(n),i=s.assignees.indexOf(e);i!==-1&&s.assignees.splice(i,1)}),console.debug("Removing assignee from pool",n)}}},{key:"getAssignee",value:function(e){var t=this.assignees.filter(function(t){return e===t.uuid});return 0===t.length?null:t[0]}},{key:"registerJob",value:function(e){var t=e.name,n=e.interval,s=this.getJob(t);if(null!==s)return console.debug("Amending job",e),s.setInterval(n),s;console.debug("Registering job",e);var i=new f.default(t,n);return this.jobs.push(i),i}},{key:"unregisterJob",value:function(e){var t=this;this.jobs.filter(function(t){var n=t.name;return n===e.name}).forEach(function(e){var n=t.jobs.indexOf(e);t.jobs.splice(n,1)})}},{key:"getJob",value:function(e){var t=this.jobs.filter(function(t){return e===t.name});return 0===t.length?null:t[0]}},{key:"now",value:function(){return Date.now()}}]),e}();t.default=d},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),i=function(){function e(t,s){n(this,e),this.name=t,this.interval=s,this.lastSucceeded=0,this.lastResponse=null,this.assignedTo=null,this.assignees=[]}return s(e,[{key:"setInterval",value:function(e){this.interval=e}},{key:"setAssignedTo",value:function(e,t){this.assignedTo=e,this.lastAssigned=t}},{key:"setCompleted",value:function(e,t){this.lastSucceeded=e,this.lastResponse=t,this.assignedTo=null}},{key:"removeAssignee",value:function(e){var t=this.assignees.indexOf(e);t>-1?this.assignees.splice(t,1):console.warn("Couldnt find uuid to remove",e,this),this.assignedTo===e&&(this.assignedTo=null)}},{key:"addAssignee",value:function(e){var t=this.assignees.indexOf(e);t===-1&&this.assignees.push(e)}}]),e}();t.default=i},function(e,t){"use strict";function n(){for(var e={},t=s,n=arguments.length,c=Array(n),f=0;f<n;f++)c[f]=arguments[f];"number"==typeof c[c.length-1]&&(t=c.splice(c.length-1,1),s<t&&(t=s));var g="#"+c.join("/")+":";return i.forEach(function(n,s){s<=t?a?e[n]=function(){u!==g&&(null!==u&&(o.groupEnd(),clearTimeout(l)),o.group(g),u=g,l=setTimeout(function(){o.groupEnd(),u=null},16));for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(o[n]||o.log).apply(o,t)}:e[n]=function(){var e;return(o[n]||o.log).apply(o,(e=[g]).concat.apply(e,arguments))}:e[n]=r}),e}Object.defineProperty(t,"__esModule",{value:!0});var s=/not minified/.test(function(){})?3:0,i=["error","warn","log","debug"],r=function(){},o=console,a=!!o.group,u=null,l=null;t.default=n},function(e,t,n){e.exports=function(){return new SharedWorker(n.p+"6aa15306e543f71b3e29.sharedworker.js")}},function(e,t){(function(t){var n,s=t.crypto||t.msCrypto;if(s&&s.getRandomValues){var i=new Uint8Array(16);n=function(){return s.getRandomValues(i),i}}if(!n){var r=new Array(16);n=function(){for(var e,t=0;t<16;t++)0===(3&t)&&(e=4294967296*Math.random()),r[t]=e>>>((3&t)<<3)&255;return r}}e.exports=n}).call(t,function(){return this}())},function(e,t,n){function s(e,t,n){var s=t&&n||0,i=0;for(t=t||[],e.toLowerCase().replace(/[0-9a-f]{2}/g,function(e){i<16&&(t[s+i++]=l[e])});i<16;)t[s+i++]=0;return t}function i(e,t){var n=t||0,s=u;return s[e[n++]]+s[e[n++]]+s[e[n++]]+s[e[n++]]+"-"+s[e[n++]]+s[e[n++]]+"-"+s[e[n++]]+s[e[n++]]+"-"+s[e[n++]]+s[e[n++]]+"-"+s[e[n++]]+s[e[n++]]+s[e[n++]]+s[e[n++]]+s[e[n++]]+s[e[n++]]}function r(e,t,n){var s=t&&n||0,r=t||[];e=e||{};var o=void 0!==e.clockseq?e.clockseq:d,a=void 0!==e.msecs?e.msecs:(new Date).getTime(),u=void 0!==e.nsecs?e.nsecs:h+1,l=a-v+(u-h)/1e4;if(l<0&&void 0===e.clockseq&&(o=o+1&16383),(l<0||a>v)&&void 0===e.nsecs&&(u=0),u>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");v=a,h=u,d=o,a+=122192928e5;var c=(1e4*(268435455&a)+u)%4294967296;r[s++]=c>>>24&255,r[s++]=c>>>16&255,r[s++]=c>>>8&255,r[s++]=255&c;var f=a/4294967296*1e4&268435455;r[s++]=f>>>8&255,r[s++]=255&f,r[s++]=f>>>24&15|16,r[s++]=f>>>16&255,r[s++]=o>>>8|128,r[s++]=255&o;for(var b=e.node||g,y=0;y<6;y++)r[s+y]=b[y];return t?t:i(r)}function o(e,t,n){var s=t&&n||0;"string"==typeof e&&(t="binary"==e?new Array(16):null,e=null),e=e||{};var r=e.random||(e.rng||a)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t)for(var o=0;o<16;o++)t[s+o]=r[o];return t||i(r)}for(var a=n(8),u=[],l={},c=0;c<256;c++)u[c]=(c+256).toString(16).substr(1),l[u[c]]=c;var f=a(),g=[1|f[0],f[1],f[2],f[3],f[4],f[5]],d=16383&(f[6]<<8|f[7]),v=0,h=0,b=o;b.v1=r,b.v4=o,b.parse=s,b.unparse=i,e.exports=b}]);